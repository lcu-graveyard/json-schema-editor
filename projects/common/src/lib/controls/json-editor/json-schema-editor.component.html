<form
    fxLayout="row"
    fxLayoutGap="10px"
    [formGroup]="JSONSchemaEditorForm"
    novalidate>

    <!--Parent/Child Nodes-->
    <mat-card class="example-card">
      <mat-card-header>
          <div mat-card-avatar class="example-header-image">
          <mat-icon color="primary">view_headline</mat-icon>
          </div>
          <mat-card-title>JSON Schema</mat-card-title>
          <mat-card-subtitle>Editor</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
          <div formArrayName="JSONFields">

                <!--TestItems instead of DynamicControlItems-->
                <div *ngFor="let itm of DynamicControlItems; let i = index">
                        <div [formGroupName]="i" fxLayout="row">
                          <mat-accordion class="margin-bottom-2" [ngStyle]="{'margin-left': itm.Indent +'px'}">
                            <mat-expansion-panel (opened)="PanelOpenState = true" (closed)="PanelOpenState = false">
                              <mat-expansion-panel-header [collapsedHeight]="ExpansionPanelClosedHeight">
                                <mat-panel-title>
                                  <mat-label>{{itm.ControlName}}</mat-label>
                                </mat-panel-title>
                                <mat-panel-description>
                                </mat-panel-description>
                              </mat-expansion-panel-header>
                              
                              <mat-icon>edit</mat-icon>
                              <div fxFlex fxLayout="column" [ngStyle]="{'margin-left': 10 +'px'}">  
                                <mat-form-field>
                                    <input 
                                      matInput 
                                      formControlName="Key" 
                                      placeholder="Key"
                                      (click)="ControlSelected(itm, i)" 
                                      value="{{itm.Key}}">
                                </mat-form-field>
                                  
                                <mat-form-field *ngIf="itm.DotNotatedPath">
                                  <input 
                                        [disabled]
                                        matInput 
                                        formControlName="DotNotatedPath" 
                                        placeholder="Full Path"
                                        value="{{itm.DotNotatedPath}}">
                                </mat-form-field>
                              </div>
                              <!--If ValueType is array, then loop over those values-->
                              <div fxFlex *ngIf="itm.ValueDataType === 'array'">
                                <mat-form-field fxLayout="column" *ngFor="let arrItm of itm.Value; let arrIdx = index" [ngStyle]="{'margin-left': 20 +'px'}">
                                    <input 
                                    placeholder="Index {{arrIdx}}"
                                    matInput 
                                    value="{{arrItm}}">
                                </mat-form-field>
                            </div>
                            <!--^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^-->
                            <!--If ValueType is array, then loop over those values-->


                              <mat-form-field *ngIf="itm.ValueDataType === 'string'" [ngStyle]="{'margin-left': 10 +'px'}">
                                  <input 
                                    matInput 
                                    placeholder="Value"
                                    formControlName="Value" 
                                    value="{{itm.Value}}"
                                    (click)="ControlSelected(itm, i)">
                              </mat-form-field>
      
                            </mat-expansion-panel>
                          </mat-accordion>
                        </div>
                    </div>
              <!-- <div *ngFor="let itm of DynamicControlItems; let i=index">
                  <div [formGroupName]="i" fxLayout="row">
                    <mat-json-editor class="margin-bottom-3" [ngStyle]="{'margin-left': itm.Indent +'px'}">
                      <mat-expansion-panel (opened)="PanelOpenState = true" (closed)="PanelOpenState = false">
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-label>{{itm.Key}}</mat-label>
                          </mat-panel-title>
                          <mat-panel-description>
                          </mat-panel-description>
                        </mat-expansion-panel-header>

                        <mat-form-field>
                            <input matInput formControlName="Key" (click)="ControlSelected(itm, i)">
                        </mat-form-field>

                        <mat-form-field [ngStyle]="{'margin-left': 10 +'px'}">
                            <input 
                            matInput 
                            formControlName="Value" 
                            (click)="ControlSelected(itm, i)">
                        </mat-form-field>

                      </mat-expansion-panel>
                    </mat-json-editor>
                  </div>
              </div> -->




          </div>
      </mat-card-content>
  </mat-card>
    <!--Modified Schema-->
    <mat-card>
      <mat-card-header>
          <div mat-card-avatar class="example-header-image">
              <mat-icon color="primary">edit</mat-icon>
          </div>
          <mat-card-title>JSON Schema</mat-card-title>
          <mat-card-subtitle>Modified</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content fxLayout="column">
          <mat-form-field appearance="outline" style="width: 400px">
              <mat-label>JSON Schema</mat-label>
              <textarea
                  formControlName="editedSchemaControl"
                  matInput
                  cdkTextareaAutosize
                  cdkAutosizeMinRows="25"
                  cdkAutosizeMaxRows="25">
              </textarea>
          </mat-form-field>
          <div fxLayoutGap="10px">
              <div fxFlex>
                  <button mat-raised-button color="primary" [disabled]="!JSONSchemaEditorForm.valid" (click)="Save()">
                      Save Changes
                  </button>
              </div>
          </div>  
      </mat-card-content>
  </mat-card>
  <div [innerHTML]="InnerTextTest"></div>
</form> 
